{% extends "base.html" %}

{% block title %}Google Drive Sync - Landlord Command Centre{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Google Drive Sync</h1>
    <p class="subtitle">Automatically import documents from your Google Drive</p>
</div>

<!-- Connection Status -->
<div class="card status-card">
    <div class="status-header">
        <div class="status-icon {% if is_authenticated %}connected{% else %}disconnected{% endif %}">
            {% if is_authenticated %}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            {% else %}
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            {% endif %}
        </div>
        <div class="status-text">
            {% if is_authenticated %}
            <h3>Connected to Google Drive</h3>
            <p>Your Google Drive is linked. You can scan and sync documents.</p>
            {% elif is_configured %}
            <h3>Not Connected</h3>
            <p>Click below to connect your Google Drive account.</p>
            {% else %}
            <h3>Not Configured</h3>
            <p>Google API credentials are not set up yet.</p>
            {% endif %}
        </div>
    </div>

    <div class="status-actions">
        {% if is_authenticated %}
        <a href="{{ url_for('drive_scan') }}" class="btn btn-primary">Scan Google Drive</a>
        <form action="{{ url_for('drive_disconnect') }}" method="post" style="margin: 0;">
            <button type="submit" class="btn btn-secondary">Disconnect</button>
        </form>
        {% elif is_configured %}
        <a href="{{ url_for('oauth_google') }}" class="btn btn-primary">Connect Google Drive</a>
        {% endif %}
    </div>
</div>

{% if not is_configured %}
<!-- Setup Instructions -->
<div class="card setup-card">
    <h2>Setup Instructions</h2>
    <p>To enable Google Drive sync, you need to create Google API credentials:</p>

    <ol class="setup-steps">
        <li>
            <strong>Go to Google Cloud Console</strong>
            <p><a href="https://console.cloud.google.com/apis/credentials" target="_blank">https://console.cloud.google.com/apis/credentials</a></p>
        </li>
        <li>
            <strong>Create a new project</strong> (or select existing)
        </li>
        <li>
            <strong>Enable the Google Drive API</strong>
            <p>Go to "Library" and search for "Google Drive API", then enable it</p>
        </li>
        <li>
            <strong>Create OAuth 2.0 credentials</strong>
            <p>Go to "Credentials" → "Create Credentials" → "OAuth client ID"</p>
            <p>Application type: <strong>Web application</strong></p>
        </li>
        <li>
            <strong>Add authorized redirect URI:</strong>
            <code>http://localhost:8080/oauth/callback</code>
        </li>
        <li>
            <strong>Copy the Client ID and Client Secret</strong>
        </li>
        <li>
            <strong>Add to your .env file:</strong>
            <pre>GOOGLE_CLIENT_ID=your_client_id_here
GOOGLE_CLIENT_SECRET=your_client_secret_here</pre>
        </li>
        <li>
            <strong>Restart the app</strong>
        </li>
    </ol>
</div>
{% endif %}

<!-- How It Works -->
<div class="card">
    <h2>How It Works</h2>

    <div class="how-it-works">
        <div class="step-item">
            <div class="step-number">1</div>
            <div class="step-content">
                <h4>Organize Your Drive</h4>
                <p>Create a folder called <strong>"Landlord Documents"</strong> in your Google Drive. Inside, create a folder for each property using the property address as the folder name.</p>
            </div>
        </div>

        <div class="step-item">
            <div class="step-number">2</div>
            <div class="step-content">
                <h4>Add Documents</h4>
                <p>Put your PDFs in each property folder. Name them clearly:</p>
                <ul>
                    <li><strong>Gas Safety</strong> - "Gas Safety 2024.pdf" or "CP12.pdf"</li>
                    <li><strong>EICR</strong> - "EICR.pdf" or "Electrical Certificate.pdf"</li>
                    <li><strong>EPC</strong> - "EPC.pdf" or "Energy Certificate.pdf"</li>
                    <li><strong>Tenancy</strong> - "Tenancy Agreement.pdf" or "AST.pdf"</li>
                </ul>
            </div>
        </div>

        <div class="step-item">
            <div class="step-number">3</div>
            <div class="step-content">
                <h4>Scan & Sync</h4>
                <p>Click "Scan Google Drive" to find your documents. The app will match folders to your properties and identify document types automatically.</p>
            </div>
        </div>
    </div>

    <div class="folder-structure">
        <h4>Example Folder Structure:</h4>
        <pre>
Google Drive/
└── Landlord Documents/
    ├── 45 Oak Street/
    │   ├── Gas Safety 2024.pdf
    │   ├── EICR 2023.pdf
    │   ├── EPC.pdf
    │   └── Tenancy - John Smith.pdf
    └── 12 Maple Road/
        ├── Gas Certificate.pdf
        └── Tenancy Agreement.pdf</pre>
    </div>
</div>

<style>
.page-header {
    margin-bottom: 2rem;
}

.page-header h1 {
    margin: 0 0 0.5rem 0;
}

.subtitle {
    color: #666;
    margin: 0;
}

.status-card {
    margin-bottom: 1.5rem;
}

.status-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.status-icon {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.status-icon.connected {
    background: #d4edda;
    color: #155724;
}

.status-icon.disconnected {
    background: #f8d7da;
    color: #721c24;
}

.status-text h3 {
    margin: 0 0 0.25rem 0;
}

.status-text p {
    margin: 0;
    color: #666;
}

.status-actions {
    display: flex;
    gap: 0.75rem;
}

.setup-card {
    margin-bottom: 1.5rem;
}

.setup-steps {
    padding-left: 1.5rem;
}

.setup-steps li {
    margin-bottom: 1rem;
    padding-left: 0.5rem;
}

.setup-steps p {
    margin: 0.25rem 0 0 0;
    color: #666;
    font-size: 0.9rem;
}

.setup-steps code {
    background: #f4f4f4;
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
}

.setup-steps pre {
    background: #1a1a2e;
    color: #4ECDC4;
    padding: 1rem;
    border-radius: 8px;
    margin-top: 0.5rem;
    overflow-x: auto;
}

.how-it-works {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.step-item {
    display: flex;
    gap: 1rem;
}

.step-number {
    width: 32px;
    height: 32px;
    background: #4ECDC4;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    flex-shrink: 0;
}

.step-content h4 {
    margin: 0 0 0.5rem 0;
}

.step-content p {
    margin: 0;
    color: #666;
}

.step-content ul {
    margin: 0.5rem 0 0 0;
    padding-left: 1.25rem;
    color: #666;
}

.step-content li {
    margin-bottom: 0.25rem;
}

.folder-structure {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
}

.folder-structure h4 {
    margin: 0 0 0.5rem 0;
}

.folder-structure pre {
    margin: 0;
    font-size: 0.85rem;
    color: #333;
    background: none;
}

.btn {
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: none;
    display: inline-block;
}

.btn-primary {
    background: #4ECDC4;
    color: white;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}
</style>
{% endblock %}
