{% extends "base.html" %}

{% block title %}{{ tenancy.tenant_names }} - Landlord Command Centre{% endblock %}

{% block content %}
<h1>Tenancy #{{ tenancy.id }}</h1>

<div class="detail-grid">
    <div class="card">
        <h2>Tenant Details</h2>
        <div class="detail-item">
            <div class="label">Tenant(s)</div>
            <div class="value">{{ tenancy.tenant_names }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Property</div>
            <div class="value">
                {% if property %}
                    <a href="{{ url_for('property_detail', property_id=property.id) }}">
                        {{ property.address }}, {{ property.postcode }}
                    </a>
                {% else %}
                    Property #{{ tenancy.property_id }}
                {% endif %}
            </div>
        </div>
        <div class="detail-item">
            <div class="label">Status</div>
            <div class="value">
                {% if tenancy.is_active %}
                    <span class="badge badge-success">Active</span>
                {% else %}
                    <span class="badge badge-warning">Ended</span>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="card">
        <h2>Tenancy Dates</h2>
        <div class="detail-item">
            <div class="label">Start Date</div>
            <div class="value">{{ tenancy.tenancy_start_date }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Fixed Term End</div>
            <div class="value">{{ tenancy.fixed_term_end_date or 'Periodic' }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Type</div>
            <div class="value">{{ 'Periodic' if tenancy.is_periodic else 'Fixed Term' }}</div>
        </div>
    </div>

    <div class="card">
        <h2>Rent & Deposit</h2>
        <div class="detail-item">
            <div class="label">Rent</div>
            <div class="value">Â£{{ "{:,.2f}".format(tenancy.rent_amount) }} {{ tenancy.rent_frequency.value }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Weekly Equivalent</div>
            <div class="value">Â£{{ "{:,.2f}".format(tenancy.weekly_rent) }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Deposit</div>
            <div class="value">Â£{{ "{:,.2f}".format(tenancy.deposit_amount) }}</div>
        </div>
    </div>

    <div class="card">
        <h2>Compliance Status</h2>
        <div class="detail-item">
            <div class="label">Deposit Protected</div>
            <div class="value">
                {% if tenancy.deposit_protected %}
                    <span class="badge badge-success">Yes</span>
                    {% if tenancy.deposit_protection_date %}
                        ({{ tenancy.deposit_protection_date }})
                    {% endif %}
                {% else %}
                    <span class="badge badge-danger">No</span>
                {% endif %}
            </div>
        </div>
        <div class="detail-item">
            <div class="label">Prescribed Info Served</div>
            <div class="value">
                {% if tenancy.prescribed_info_served %}
                    <span class="badge badge-success">Yes</span>
                {% else %}
                    <span class="badge badge-danger">No</span>
                {% endif %}
            </div>
        </div>
        <div class="detail-item">
            <div class="label">How to Rent Served</div>
            <div class="value">
                {% if tenancy.how_to_rent_served %}
                    <span class="badge badge-success">Yes</span>
                {% else %}
                    <span class="badge badge-danger">No</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Compliance Timeline -->
{% if events %}
<div class="card" style="margin-top: 1.5rem;">
    <h2>ðŸ“… Compliance Timeline</h2>
    <table>
        <thead>
            <tr>
                <th>Status</th>
                <th>Due Date</th>
                <th>Task</th>
                <th>Priority</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr style="{% if event.status == EventStatus.OVERDUE %}background: #fff5f5;{% elif event.status == EventStatus.COMPLETED %}opacity: 0.6;{% endif %}">
                <td>
                    {% if event.status == EventStatus.OVERDUE %}
                        <span class="badge badge-danger">OVERDUE</span>
                    {% elif event.status == EventStatus.COMPLETED %}
                        <span class="badge badge-success">DONE</span>
                    {% else %}
                        <span class="badge">PENDING</span>
                    {% endif %}
                </td>
                <td>
                    {% if event.status == EventStatus.OVERDUE %}
                        <span style="color: #dc3545; font-weight: bold;">
                    {% endif %}
                    {{ event.due_date.strftime('%d %b %Y') if event.due_date else '-' }}
                    {% if event.status == EventStatus.OVERDUE %}
                        </span>
                    {% endif %}
                </td>
                <td>
                    <strong>{{ event.event_name }}</strong>
                    <br><small style="color: #666;">{{ event.notes[:80] }}...</small>
                </td>
                <td>
                    {% if event.priority == EventPriority.CRITICAL %}
                        <span class="badge badge-danger">CRITICAL</span>
                    {% elif event.priority == EventPriority.HIGH %}
                        <span class="badge badge-warning">HIGH</span>
                    {% elif event.priority == EventPriority.MEDIUM %}
                        <span class="badge">MEDIUM</span>
                    {% else %}
                        <span class="badge">LOW</span>
                    {% endif %}
                </td>
                <td>
                    {% if event.status != EventStatus.COMPLETED %}
                    <form method="POST" action="{{ url_for('complete_event', event_id=event.id) }}" style="display: inline;">
                        <button type="submit" class="btn" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">
                            âœ“ Done
                        </button>
                    </form>
                    {% else %}
                        <span style="color: #27ae60;">âœ“</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
